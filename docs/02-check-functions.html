<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Check Functions</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Salutem</span> <span class="project-version">0.1.8-RC1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="01-getting-started.html"><div class="inner"><span>Getting Started</span></div></a></li><li class="depth-1  current"><a href="02-check-functions.html"><div class="inner"><span>Check Functions</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>salutem</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>check-fns</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-source</span></div></div></li><li class="depth-4"><a href="salutem.check-fns.data-source.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>http-endpoint</span></div></div></li><li class="depth-4"><a href="salutem.check-fns.http-endpoint.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><a href="salutem.core.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.checks.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checks</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.maintenance.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>maintenance</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.results.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>results</span></div></a></li><li class="depth-3"><a href="salutem.core.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#check-functions" name="check-functions"></a>Check Functions</h1>
<p><code>salutem</code> includes a set of standard check functions for commonly checked things. Currently, <code>salutem</code> includes check functions for:</p>
<ul>
  <li>data sources; and</li>
  <li>HTTP endpoints.</li>
</ul>
<h2><a href="#contents" name="contents"></a>Contents</h2>
<ul>
  <li><a href="#http-endpoint-check-function">HTTP endpoint check function</a>
    <ul>
      <li><a href="#http-endpoint-check-function-installation">Installation</a></li>
      <li><a href="#http-endpoint-check-function-usage">Usage</a></li>
    </ul>
  </li>
  <li><a href="#data-source-check-function">Data source check function</a>
    <ul>
      <li><a href="#data-source-check-function-installation">Installation</a></li>
      <li><a href="#data-source-check-function-usage">Usage</a></li>
    </ul>
  </li>
</ul>
<h2><a href="#http-endpoint-check-function" name="http-endpoint-check-function"></a>HTTP endpoint check function</h2>
<p>The HTTP endpoint check function is highly configurable allowing it to support most types of HTTP endpoint. Specifically, the HTTP endpoint check function allows configuration of:</p>
<ul>
  <li>the request method, body, headers and query string;</li>
  <li>request timeouts (connection request, connection and socket);</li>
  <li>what constitutes a successful response;</li>
  <li>the underlying reason for any possible exception;</li>
  <li>the functions used to generate results; and</li>
  <li>many more advanced HTTP client options.</li>
</ul>
<h3><a href="#installation" name="installation"></a><span id="http-endpoint-check-function-installation">Installation</span></h3>
<p>To install the check function module, add the following to your <code>project.clj</code> file:</p>
<pre><code class="clojure">[io.logicblocks/salutem.check-fns.http-endpoint "0.1.7"]
</code></pre>
<h3><a href="#usage" name="usage"></a><span id="http-endpoint-check-function-usage">Usage</span></h3>
<p>To create a check, using an HTTP endpoint check function, of a hypothetical external user profile service:</p>
<pre><code class="clojure">(require '[salutem.core :as salutem])
(require '[salutem.check-fns.http-endpoint.core :as salutem-http])

(def user-profile-service-ping-url 
  "https://user-profile-service.example.com/ping")

(def user-profile-service-check
  (salutem/background-check
    :services/user-profile
    (salutem-http/http-endpoint-check-fn
      user-profile-service-ping-url)))
</code></pre>
<p>By default, the check function will:</p>
<ul>
  <li>be a <code>GET</code> request with no body, request headers or query parameters;</li>
  <li>use connection request, connection and socket timeouts of 5 seconds;</li>
  <li>treat responses with standard 200 and 300 status codes as healthy and all  others as unhealthy; and</li>
  <li>include nothing from the request or response in the produced result.</li>
</ul>
<h4><a href="#customising-the-request" name="customising-the-request"></a>Customising the request</h4>
<h5><a href="#method" name="method"></a>Method</h5>
<p>To change the request method for the check, pass the <code>:method</code> option:</p>
<pre><code class="clojure">(require '[salutem.check-fns.http-endpoint.core :as salutem-http])

(def check-fn
  (salutem-http/http-endpoint-check-fn
    "https://user-profile-service.example.com/ping"
    {:method :head}))
</code></pre>
<p>The <code>:method</code> option supports <code>:get</code>, <code>:head</code>, <code>:post</code>, <code>:put</code>, <code>:delete</code>, <code>:options</code>, <code>:copy</code>, <code>:move</code> and <code>:patch</code>.</p>
<p>If the <code>:method</code> option is instead a function, it will be called with the context map at execution time in order to obtain the method to use.</p>
<h5><a href="#body" name="body"></a>Body</h5>
<p>To set a body on the request, pass the <code>:body</code> option:</p>
<pre><code class="clojure">(require '[salutem.check-fns.http-endpoint.core :as salutem-http])

(def check-fn
  (salutem-http/http-endpoint-check-fn
    "https://user-profile-service.example.com/ping"
    {:method :post
     :body "{\"status\": \"listening\"}"}))
</code></pre>
<p>The <code>:body</code> option accepts anything supported by <a href="https://github.com/dakrone/clj-http"><code>clj-http</code></a>. Just as for <code>:method</code>, if the <code>:body</code> function is instead a function, it will be called with the context map at execution time in order to obtain the body to use.</p>
<h5><a href="#headers" name="headers"></a>Headers</h5>
<p>To set headers on the request, pass the <code>:headers</code> option:</p>
<pre><code class="clojure">(require '[salutem.check-fns.http-endpoint.core :as salutem-http])

(def api-key "ffa55748904f4545de55751e9bd2c5abb45596bd")

(def check-fn
  (salutem-http/http-endpoint-check-fn
    "https://user-profile-service.example.com/ping"
    {:headers {:authorization (str "Bearer " api-key)}}))
</code></pre>
<p>The <code>:headers</code> option accepts anything supported by <a href="https://github.com/dakrone/clj-http"><code>clj-http</code></a> and can be a function of context as with the other request options.</p>
<h5><a href="#query-parameters" name="query-parameters"></a>Query parameters</h5>
<p>To set query parameters on the endpoint URL, pass the <code>:query-params</code> option:</p>
<pre><code class="clojure">(require '[salutem.check-fns.http-endpoint.core :as salutem-http])

(def api-key "ffa55748904f4545de55751e9bd2c5abb45596bd")

(def check-fn
  (salutem-http/http-endpoint-check-fn
    "https://user-profile-service.example.com/ping"
    {:query-params {"api_key" api-key}}))
</code></pre>
<p>The <code>:query-params</code> option accepts anything supported by <a href="https://github.com/dakrone/clj-http"><code>clj-http</code></a> and can be a function of context as with the other request options.</p>
<h2><a href="#data-source-check-function" name="data-source-check-function"></a>Data source check function</h2>
<p>The data source check function is highly configurable and supports any <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/javax/sql/DataSource.html">javax.sql.DataSource</a>.</p>
<h3><a href="#installation" name="installation"></a><span id="data-source-check-function-installation">Installation</span></h3>
<p>To install the check function, add the following to your <code>project.clj</code> file:</p>
<pre><code class="clojure">[io.logicblocks/salutem.check-fns.data-source "0.1.7"]
</code></pre>
<h3><a href="#usage" name="usage"></a><span id="data-source-check-function-usage">Usage</span></h3>
<p>The data source check function supports:</p>
<p>*</p></div></div></div></body></html>