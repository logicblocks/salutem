<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>salutem.check-fns.data-source.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Salutem</span> <span class="project-version">0.1.7</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="01-getting-started.html"><div class="inner"><span>Getting Started</span></div></a></li><li class="depth-1 "><a href="02-check-functions.html"><div class="inner"><span>Check Functions</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>salutem</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>check-fns</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-source</span></div></div></li><li class="depth-4 current"><a href="salutem.check-fns.data-source.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>http-endpoint</span></div></div></li><li class="depth-4"><a href="salutem.check-fns.http-endpoint.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><a href="salutem.core.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.checks.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checks</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.maintenance.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>maintenance</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.results.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>results</span></div></a></li><li class="depth-3"><a href="salutem.core.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="salutem.check-fns.data-source.core.html#var-data-source-check-fn"><div class="inner"><span>data-source-check-fn</span></div></a></li><li class="depth-1"><a href="salutem.check-fns.data-source.core.html#var-failure-reason"><div class="inner"><span>failure-reason</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">salutem.check-fns.data-source.core</h1><div class="doc"><div class="markdown"><p>Provides a data source check function for salutem.</p></div></div><div class="public anchor" id="var-data-source-check-fn"><h3>data-source-check-fn</h3><div class="usage"><code>(data-source-check-fn data-source)</code><code>(data-source-check-fn data-source {:keys [query-sql-params query-timeout query-opts query-results-result-fn failure-reason-fn exception-result-fn]})</code></div><div class="doc"><div class="markdown"><p>Returns a check function for the provided <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/javax/sql/DataSource.html">javax.sql.DataSource</a>.</p>
<p>Accepts the following options in the option map:</p>
<ul>
  <li><code>:query-sql-params</code>: an SQL parameter vector (as defined in <a href="https://github.com/seancorfield/next-jdbc"><code>next.jdbc</code></a>) or a function of context that will return an SQL parameter vector containing the health check query to execute against the data source, defaults to <code>["SELECT 1 AS up;"]</code>.</li>
  <li><code>:query-timeout</code>: a <a href="salutem.core.html#var-duration">salutem.core/duration</a> or a function of context that will return a <a href="salutem.core.html#var-duration">salutem.core/duration</a> representing the amount of time to wait for the query to finish before considering it failed; defaults to 5 seconds.</li>
  <li><code>:query-opts</code>: additional options (as defined in <a href="https://github.com/seancorfield/next-jdbc"><code>next.jdbc</code></a>) or a function of context that will return additional options to pass at query execution time; by default, includes a builder function for rows that returns unqualified kebab-cased maps; additional options are merged into the default option map.</li>
  <li><code>:query-results-result-fn</code>: a function, of context and the results of the query, used to produce a result for the check; by default, a healthy result is returned, including the contents of the first record from the results.</li>
  <li><code>:failure-reason-fn</code>: a function, of context and an exception, to determine the reason for a failure; by default uses <a href="salutem.check-fns.data-source.core.html#var-failure-reason">failure-reason</a>.</li>
  <li><code>:exception-result-fn</code>: a function, of context and an exception, used to produce a result for the check in the case that an exception is thrown; by default, an unhealthy result is returned including a <code>:salutem/reason</code> entry with the reason derived by <code>:failure-reason-fn</code> and a <code>:salutem/exception</code> entry containing the thrown exception.</li>
</ul>
<p>If the returned check function is invoked with a context map including a  <code>:logger</code> key with a  <a href="https://logicblocks.github.io/cartus/cartus.core.html#var-Logger"><code>cartus.core/Logger</code></a>  value, the check function will emit a number of log events whilst  executing.</p></div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.7/check-fns/data-source/src/salutem/check_fns/data_source/core.clj#L35">view source</a></div></div><div class="public anchor" id="var-failure-reason"><h3>failure-reason</h3><div class="usage"><code>(failure-reason exception)</code></div><div class="doc"><div class="markdown"><p>Determines the failure reason associated with an exception.</p>
<p>This failure reason function, the default used by the check function, uses a reason of <code>:threw-exception</code> for all exceptions other than a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/SQLTimeoutException.html">java.sql.SQLTimeoutException</a> for which the reason is <code>:timed-out</code>.</p>
<p>In the case that this default behaviour is insufficient, an alternative failure reason function can be passed to <a href="salutem.check-fns.data-source.core.html#var-data-source-check-fn">data-source-check-fn</a> using the <code>:failure-reason-fn</code> option.</p></div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.7/check-fns/data-source/src/salutem/check_fns/data_source/core.clj#L19">view source</a></div></div></div></body></html>