<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>salutem.core.checks documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Salutem</span> <span class="project-version">0.1.7</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="01-getting-started.html"><div class="inner"><span>Getting Started</span></div></a></li><li class="depth-1 "><a href="02-check-functions.html"><div class="inner"><span>Check Functions</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>salutem</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>check-fns</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-source</span></div></div></li><li class="depth-4"><a href="salutem.check-fns.data-source.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>http-endpoint</span></div></div></li><li class="depth-4"><a href="salutem.check-fns.http-endpoint.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><a href="salutem.core.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch current"><a href="salutem.core.checks.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checks</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.maintenance.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>maintenance</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.results.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>results</span></div></a></li><li class="depth-3"><a href="salutem.core.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="salutem.core.checks.html#var-attempt"><div class="inner"><span>attempt</span></div></a></li><li class="depth-1"><a href="salutem.core.checks.html#var-background-check"><div class="inner"><span>background-check</span></div></a></li><li class="depth-1"><a href="salutem.core.checks.html#var-background.3F"><div class="inner"><span>background?</span></div></a></li><li class="depth-1"><a href="salutem.core.checks.html#var-evaluate"><div class="inner"><span>evaluate</span></div></a></li><li class="depth-1"><a href="salutem.core.checks.html#var-realtime-check"><div class="inner"><span>realtime-check</span></div></a></li><li class="depth-1"><a href="salutem.core.checks.html#var-realtime.3F"><div class="inner"><span>realtime?</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">salutem.core.checks</h1><div class="doc"><div class="markdown"><p>Provides constructors, predicates and evaluation functions for checks.</p></div></div><div class="public anchor" id="var-attempt"><h3>attempt</h3><div class="usage"><code>(attempt dependencies trigger-id check)</code><code>(attempt dependencies trigger-id check context)</code><code>(attempt dependencies trigger-id check context result-channel)</code></div><div class="doc"><div class="markdown"><p>Attempts to obtain a result for a check, handling timeouts and exceptions.</p>
<p>Takes the following parameters:</p>
<ul>
  <li><code>dependencies</code>: A map of dependencies used by <code>attempt</code> in obtaining the result, currently supporting only a <code>:logger</code> entry with a <a href="https://logicblocks.github.io/cartus/cartus.core.html#var-Logger"><code>cartus.core/Logger</code></a> value.</li>
  <li><code>trigger-id</code>: An ID identifying the attempt in any subsequently produced messages and used in logging.</li>
  <li><code>check</code>: the check to be attempted.</li>
  <li><code>context</code>: an optional map containing arbitrary context required by the check in order to run and passed to the check functions as the first argument; defaults to an empty map.</li>
  <li><code>result-channel</code>: an optional channel on which to send the result message; defaults to a channel with a buffer length of 1.</li>
</ul>
<p>The attempt is performed asynchronously and the result channel is returned immediately.</p>
<p>In the case that the attempt takes longer than the checkâ€™s timeout, an unhealthy result is produced, including <code>:salutem/reason</code> as <code>:timed-out</code>.</p>
<p>In the case that the attempt throws an exception, an unhealthy result is produced, including <code>:salutem/reason</code> as <code>:exception-thrown</code> and including the exception at <code>:salutem/exception</code>.</p>
<p>In all other cases, the result produced by the check is passed on to the result channel.</p>
<p>All produced results include a <code>:salutem/evaluation-duration</code> entry with the time taken to obtain the result, which can be overridden within check functions if required.</p></div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.7/core/src/salutem/core/checks.clj#L120">view source</a></div></div><div class="public anchor" id="var-background-check"><h3>background-check</h3><div class="usage"><code>(background-check check-name check-fn)</code><code>(background-check check-name check-fn opts)</code></div><div class="doc"><div class="markdown"><p>Constructs a background check with the provided name and check function.</p>
<p>A background check is one that is evaluated periodically with the result cached in a registry until the next evaluation, conducted by a maintenance pipeline, which will occur once the time to re-evaluation of the check has passed.</p>
<p>Background checks are useful for external dependencies where it is important not to perform the check too frequently and where the health status only needs to be accurate on the order of the time to re-evaluation.</p>
<p>Takes the following parameters:</p>
<ul>
  <li><code>check-name</code>: a keyword representing the name of the check</li>
  <li><code>check-fn</code>: an arity-2 function, with the first argument being a context map as provided during evaluation or at maintenance pipeline construction and the second argument being a callback function which should be called with the result of the check to signal the check is complete; note, check functions <em>must</em> be non-blocking.</li>
  <li><code>opts</code>: an optional map of additional options for the check, containing:
    <ul>
      <li><code>:salutem/timeout</code>: a <a href="null">salutem.time/duration</a> representing the amount  of time to wait for the check to complete before considering it failed,  defaulting to 10 seconds.</li>
      <li><code>:salutem/time-to-re-evaluation</code>: a <a href="null">salutem.time/duration</a>  representing the time to wait after a check is evaluated before  attempting to re-evaluate it, defaulting to 10 seconds.</li>
    </ul>
  </li>
</ul>
<p>Any extra entries provided in the <code>opts</code> map are retained on the check for later use.</p>
<p>Note that a result for a background check may live for longer than the time to re-evaluation since evaluation takes time and the result will continue to be returned from the registry whenever the check is resolved until the evaluation has completed and the new result has been added to the registry.</p></div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.7/core/src/salutem/core/checks.clj#L26">view source</a></div></div><div class="public anchor" id="var-background.3F"><h3>background?</h3><div class="usage"><code>(background? check)</code></div><div class="doc"><div class="markdown"><p>Returns <code>true</code> if the provided check is a background check, <code>false</code> otherwise.</p></div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.7/core/src/salutem/core/checks.clj#L108">view source</a></div></div><div class="public anchor" id="var-evaluate"><h3>evaluate</h3><div class="usage"><code>(evaluate check)</code><code>(evaluate check context)</code><code>(evaluate check context callback-fn)</code></div><div class="doc"><div class="markdown"><p>Evaluates the provided check, returning the result of the evaluation.</p>
<p>Optionally takes a context map containing arbitrary context required by the check in order to run and passed to the check function as the first argument.</p>
<p>By default, the check is evaluated synchronously. If a callback function is provided, the function starts evaluation asynchronously, returns immediately and invokes the callback function with the result once available.</p></div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.7/core/src/salutem/core/checks.clj#L231">view source</a></div></div><div class="public anchor" id="var-realtime-check"><h3>realtime-check</h3><div class="usage"><code>(realtime-check check-name check-fn)</code><code>(realtime-check check-name check-fn opts)</code></div><div class="doc"><div class="markdown"><p>Constructs a realtime check with the provided name and check function.</p>
<p>A realtime check is one that is re-evaluated whenever the check is resolved, with no caching of results taking place.</p>
<p>Realtime checks are useful when the accuracy of the check needs to be very high or where the check itself is inexpensive.</p>
<p>Takes the following parameters:</p>
<ul>
  <li><code>check-name</code>: a keyword representing the name of the check</li>
  <li><code>check-fn</code>: an arity-2 function, with the first argument being a context map as provided during evaluation or at maintenance pipeline construction and the second argument being a callback function which should be called with the result fo the check to signal the check is complete; note, check functions <em>must</em> be non-blocking.</li>
  <li><code>opts</code>: an optional map of additional options for the check, containing:
    <ul>
      <li><code>:salutem/timeout</code>: a <a href="null">salutem.time/duration</a> representing the amount  of time to wait for the check to complete before considering it failed,  defaulting to 10 seconds.</li>
    </ul>
  </li>
</ul>
<p>Any extra entries provided in the <code>opts</code> map are retained on the check for later use.</p></div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.7/core/src/salutem/core/checks.clj#L76">view source</a></div></div><div class="public anchor" id="var-realtime.3F"><h3>realtime?</h3><div class="usage"><code>(realtime? check)</code></div><div class="doc"><div class="markdown"><p>Returns <code>true</code> if the provided check is a realtime check, <code>false</code> otherwise.</p></div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.7/core/src/salutem/core/checks.clj#L114">view source</a></div></div></div></body></html>