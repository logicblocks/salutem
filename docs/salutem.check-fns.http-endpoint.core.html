<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>salutem.check-fns.http-endpoint.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Salutem</span> <span class="project-version">0.1.8</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="01-getting-started.html"><div class="inner"><span>Getting Started</span></div></a></li><li class="depth-1 "><a href="02-check-functions.html"><div class="inner"><span>Check Functions</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>salutem</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>check-fns</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-source</span></div></div></li><li class="depth-4"><a href="salutem.check-fns.data-source.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>http-endpoint</span></div></div></li><li class="depth-4 current"><a href="salutem.check-fns.http-endpoint.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><a href="salutem.core.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.checks.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checks</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.maintenance.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>maintenance</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-3 branch"><a href="salutem.core.results.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>results</span></div></a></li><li class="depth-3"><a href="salutem.core.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="salutem.check-fns.http-endpoint.core.html#var-failure-reason"><div class="inner"><span>failure-reason</span></div></a></li><li class="depth-1"><a href="salutem.check-fns.http-endpoint.core.html#var-http-endpoint-check-fn"><div class="inner"><span>http-endpoint-check-fn</span></div></a></li><li class="depth-1"><a href="salutem.check-fns.http-endpoint.core.html#var-successful.3F"><div class="inner"><span>successful?</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">salutem.check-fns.http-endpoint.core</h1><div class="doc"><div class="markdown"><p>Provides an HTTP endpoint check function for salutem.</p>
<p>Packaged in a separate module, <code>salutem.check-fns.http-endpoint</code> versioned in lock step with <code>salutem.core</code>.</p>
</div></div><div class="public anchor" id="var-failure-reason"><h3>failure-reason</h3><div class="usage"><code>(failure-reason exception)</code></div><div class="doc"><div class="markdown"><p>Determines the failure reason associated with an exception.</p>
<p>This failure reason function, the default used by the check function, uses a reason of <code>:threw-exception</code> for all exceptions other than:</p>
<ul>
<li><a href="https://www.javadoc.io/doc/org.apache.httpcomponents/httpclient/latest/org/apache/http/conn/ConnectTimeoutException.html">org.apache.http.conn.ConnectTimeoutException</a></li>
<li><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/SQLTimeoutException.html">java.net.SocketTimeoutException</a></li>
<li><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/SQLTimeoutException.html">java.net.ConnectException</a> when the exception message includes “Timeout”</li>
</ul>
<p>for which the reason is <code>:timed-out</code>.</p>
<p>In the case that this default behaviour is insufficient, an alternative failure reason function can be passed to <a href="salutem.check-fns.http-endpoint.core.html#var-http-endpoint-check-fn">http-endpoint-check-fn</a> using the <code>:failure-reason-fn</code> option.</p>
</div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.8/check-fns/http-endpoint/src/salutem/check_fns/http_endpoint/core.clj#L22">view source</a></div></div><div class="public anchor" id="var-http-endpoint-check-fn"><h3>http-endpoint-check-fn</h3><div class="usage"><code>(http-endpoint-check-fn url)</code><code>(http-endpoint-check-fn url {:keys [method body headers query-params opts connection-request-timeout connection-timeout socket-timeout successful-response-fn response-result-fn failure-reason-fn exception-result-fn]})</code></div><div class="doc"><div class="markdown"><p>Returns a check function for the HTTP endpoint identified by the provided URL.</p>
<p>Accepts the following options in the option map:</p>
<ul>
<li><code>:method</code>: a keyword representing the method used to check the endpoint (one of <code>:get</code>, <code>:head</code>, <code>:post</code>, <code>:put</code>, <code>:delete</code>, <code>:options</code>, <code>:copy</code>, <code>:move</code> or <code>:patch</code>) or a function of context that will return such a keyword; defaults to <code>:get</code>.</li>
<li><code>:body</code>: an object representing the body sent to the endpoint on check execution (supporting anything <a href="https://github.com/dakrone/clj-http"><code>clj-http</code></a> will accept) or a function of context that will return such an object; defaults to <code>nil</code>.</li>
<li><code>:headers</code>: a map of headers to be sent to the endpoint on check execution (as supported by <a href="https://github.com/dakrone/clj-http"><code>clj-http</code></a>) or a function of context that will return such a map; defaults to <code>nil</code>.</li>
<li><code>:query-params</code>: a map of query parameters to be sent to the endpoint on check execution (as supported by <a href="https://github.com/dakrone/clj-http"><code>clj-http</code></a>) or a function of context that will return such a map; defaults to <code>nil</code>.</li>
<li><code>:opts</code>: a map of additional query options (as supported by <a href="https://github.com/dakrone/clj-http"><code>clj-http</code></a>) or a function of context that will return such a map; defaults to <code>{:throw-exceptions false}</code> since we want response success to be deduced by the <code>:response-result-fn</code> rather than treating unsuccessful statuses as exceptions; note that any timeouts passed in this query options map are ignored and should be set using <code>:connection-request-timeout</code>, <code>:connection-timeout</code> and <code>:socket-timeout</code>.</li>
<li><code>:connection-request-timeout</code>: the <a href="salutem.core.html#var-duration">salutem.core/duration</a> to wait when obtaining a connection from the connection manager before considering the request failed; defaults to 5 seconds.</li>
<li><code>:connection-timeout</code>: the <a href="salutem.core.html#var-duration">salutem.core/duration</a> to wait when establishing an HTTP connection before considering the request failed; defaults to 5 seconds.</li>
<li><code>:socket-timeout</code>: the <a href="salutem.core.html#var-duration">salutem.core/duration</a> to wait while streaming response data since the last data was received before considering the request failed; defaults to 5 seconds.</li>
<li><code>:successful-response-fn</code>: a function of context and the response from a request to the endpoint, returning true if the response was successful, false otherwise; by default uses <a href="salutem.check-fns.http-endpoint.core.html#var-successful.3F">successful?</a>.</li>
<li><code>:response-result-fn</code>: a function, of context and the response from a request to the endpoint, used to produce a result for the check; by default, a healthy result is returned if the response is successful according to <code>:successful-response-fn</code>, otherwise an unhealthy result is returned.</li>
<li><code>:failure-reason-fn</code>: a function, of context and an exception, to determine the reason for a failure; by default uses <a href="salutem.check-fns.http-endpoint.core.html#var-failure-reason">failure-reason</a>.</li>
<li><code>:exception-result-fn</code>: a function, of context and an exception, used to produce a result for the check in the case that an exception is thrown; by default, an unhealthy result is returned including a <code>:salutem/reason</code> entry with the reason derived by <code>:failure-reason-fn</code> and a <code>:salutem/exception</code> entry containing the thrown exception.</li>
</ul>
<p>Additionally, if the URL parameter is instead a function, it will be called with the context map at check execution time in order to obtain the endpoint URL.</p>
<p>If the returned check function is invoked with a context map including a <code>:logger</code> key with a <a href="https://logicblocks.github.io/cartus/cartus.core.html#var-Logger"><code>cartus.core/Logger</code></a> value, the check function will emit a number of log events whilst executing.</p>
</div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.8/check-fns/http-endpoint/src/salutem/check_fns/http_endpoint/core.clj#L63">view source</a></div></div><div class="public anchor" id="var-successful.3F"><h3>successful?</h3><div class="usage"><code>(successful? {:keys [status]})</code></div><div class="doc"><div class="markdown"><p>Returns true if the provided response has a successful status, false otherwise.</p>
<p>This response success function, the default used by the check function, treats status codes of 200, 201, 202, 203, 204, 205, 206, 207, 300, 301, 302, 303, 304, 307 and 308 as successful.</p>
<p>In the case that this default behaviour is insufficient, an alternative response success function can be passed to <a href="salutem.check-fns.http-endpoint.core.html#var-http-endpoint-check-fn">http-endpoint-check-fn</a> using the <code>:successful-response-fn</code> option.</p>
</div></div><div class="src-link"><a href="https://github.com/logicblocks/salutem/blob/0.1.8/check-fns/http-endpoint/src/salutem/check_fns/http_endpoint/core.clj#L49">view source</a></div></div></div></body></html>